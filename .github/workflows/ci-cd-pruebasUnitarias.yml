name: Pruebas Unitarias

on: 
  workflow_dispatch:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Descargar código
      uses: actions/checkout@v4
      
    - name: Configurar Java
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Compilar todo el proyecto Java
      run: |
        mkdir -p target/classes
        find . -name "*.java" > sources.txt
        javac -d target/classes @sources.txt
      
    - name: Verificar cálculos específicos
      run: |
        cd target/classes
        echo "Creando clase de prueba para cálculos..."
        cat > TestCalculos.java << 'EOF'
        public class TestCalculos {
            public static void main(String[] args) {
                boolean todosTestsPasaron = true;
                
                grupo1.EstrategiaCarro carro = new grupo1.EstrategiaCarro();
                double resultadoCarro = carro.calcularCO2(10);
                if (Math.abs(resultadoCarro - 2.1) < 0.01) {
                    System.out.println("CORRECTO EstrategiaCarro: " + resultadoCarro);
                } else {
                    System.out.println("ERROR EstrategiaCarro: esperado 2.1, obtenido " + resultadoCarro);
                    todosTestsPasaron = false;
                }

                grupo1.EstrategiaBus bus = new grupo1.EstrategiaBus();
                double resultadoBus = bus.calcularCO2(10);
                if (Math.abs(resultadoBus - 1.0) < 0.01) {
                    System.out.println("CORRECTO EstrategiaBus: " + resultadoBus);
                } else {
                    System.out.println("ERROR EstrategiaBus: esperado 1.0, obtenido " + resultadoBus);
                    todosTestsPasaron = false;
                }

                grupo1.EstrategiaBici bici = new grupo1.EstrategiaBici();
                double resultadoBici = bici.calcularCO2(10);
                if (resultadoBici == 0.0) {
                    System.out.println("CORRECTO EstrategiaBici: " + resultadoBici);
                } else {
                    System.out.println("ERROR EstrategiaBici: esperado 0.0, obtenido " + resultadoBici);
                    todosTestsPasaron = false;
                }

                grupo1.GrupoFuentes grupo = new grupo1.GrupoFuentes();
                grupo.addFuente(() -> 100.0);
                grupo.addFuente(() -> 200.0);
                double totalComposite = grupo.calcularCO2();
                if (Math.abs(totalComposite - 300.0) < 0.01) {
                    System.out.println("CORRECTO Composite: " + totalComposite);
                } else {
                    System.out.println("ERROR Composite: esperado 300.0, obtenido " + totalComposite);

