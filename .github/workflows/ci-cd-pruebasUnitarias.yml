name: Pruebas Unitarias

on: 
  workflow_dispatch:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Descargar cÃ³digo
      uses: actions/checkout@v4
      
    - name: Configurar Java
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Compilar todo el proyecto Java
      run: |
        echo "ðŸ”§ Compilando proyecto..."
        mkdir -p target/classes
        find scripts/bioprint/src/main/java -name "*.java" > sources.txt
        javac -d target/classes @sources.txt
        echo "CompilaciÃ³n completada"
      
    - name: Crear y ejecutar pruebas personalizadas
      run: |
        echo "Creando clase de prueba..."
        cat > target/classes/TestCalculos.java << 'EOF'
        import grupo1.*;

        public class TestCalculos {
            public static void main(String[] args) {
                boolean todosTestsPasaron = true;
                System.out.println("===== INICIO DE PRUEBAS =====");

                EstrategiaCarro carro = new EstrategiaCarro();
                double resultadoCarro = carro.calcularCO2(10);
                if (Math.abs(resultadoCarro - 2.1) < 0.01) {
                    System.out.println("Correcto EstrategiaCarro: " + resultadoCarro);
                } else {
                    System.out.println("Error EstrategiaCarro: esperado 2.1, obtenido " + resultadoCarro);
                    todosTestsPasaron = false;
                }

                EstrategiaBus bus = new EstrategiaBus();
                double resultadoBus = bus.calcularCO2(10);
                if (Math.abs(resultadoBus - 1.0) < 0.01) {
                    System.out.println("Correcto EstrategiaBus: " + resultadoBus);
                } else {
                    System.out.println("Error EstrategiaBus: esperado 1.0, obtenido " + resultadoBus);
                    todosTestsPasaron = false;
                }

                EstrategiaBici bici = new EstrategiaBici();
                double resultadoBici = bici.calcularCO2(10);
                if (resultadoBici == 0.0) {
                    System.out.println("correcto EstrategiaBici: " + resultadoBici);
                } else {
                    System.out.println("Error EstrategiaBici: esperado 0.0, obtenido " + resultadoBici);
                    todosTestsPasaron = false;
                }

                GrupoFuentes grupo = new GrupoFuentes();
                grupo.addFuente(() -> 100.0);
                grupo.addFuente(() -> 200.0);
                double totalComposite = grupo.calcularCO2();
                if (Math.abs(totalComposite - 300.0) < 0.01) {
                    System.out.println("Correcto Composite: " + totalComposite);
                } else {
                    System.out.println("Error Composite: esperado 300.0, obtenido " + totalComposite);
                    todosTestsPasaron = false;
                }

                System.out.println("===============================");
                if (todosTestsPasaron) {
                    System.out.println("TODAS LAS PRUEBAS PASARON EXITOSAMENTE");
                } else {
                    System.out.println("ALGUNAS PRUEBAS FALLARON");
                    System.exit(1);
                }
            }
        }
        EOF

        echo "Compilando TestCalculos.java..."
        javac -cp target/classes -d target/classes target/classes/TestCalculos.java

        echo "Ejecutando pruebas..."
        cd target/classes
        java -cp . TestCalculos

