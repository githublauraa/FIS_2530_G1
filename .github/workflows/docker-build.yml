name:  Build Docker Backend
# Descripción: Este flujo de trabajo compila el proyecto backend y construye la imagen Docker correspondiente.

on:
  push:
    branches: [ main ]
    # Desencadena la ejecución del flujo de trabajo ante cada envío de cambios (push) a la rama principal.
  pull_request:
    branches: [ main ]
    # Ejecuta el flujo de trabajo cuando se crea o actualiza una solicitud de extracción (Pull Request) hacia la rama principal.
  workflow_dispatch:
    # Permite la ejecución manual del flujo de trabajo desde la interfaz de GitHub Actions.

jobs:
  build:
    runs-on: ubuntu-latest
    # Define el entorno de ejecución. En este caso, se utiliza una máquina virtual con la última versión estable de Ubuntu.

    steps:
      # 1. Obtención del código fuente
      - name: Checkout repository
        uses: actions/checkout@v4
        # Clona el contenido del repositorio en el entorno del runner para que los pasos posteriores puedan acceder al código fuente.

      # 2. Configuración del entorno Java
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'  # Utiliza la distribución Temurin del OpenJDK.
          java-version: '17'       # Define la versión de Java requerida por el proyecto.
        # Este paso garantiza la compatibilidad del entorno de compilación con las dependencias y configuraciones del proyecto Maven.

      # 3. Compilación del proyecto con Maven
      - name: Build with Maven
        working-directory: scripts/backend
        run: mvn clean package -DskipTests
        # Ejecuta el ciclo de vida de compilación de Maven:
        #   - "clean" elimina artefactos de compilaciones previas.
        #   - "package" genera el archivo .jar del backend.
        #   - La opción "-DskipTests" omite las pruebas unitarias para optimizar el tiempo de ejecución.
        # Este paso valida la correcta compilación del proyecto y la resolución de dependencias.

      # 4. Configuración de Docker Buildx
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3
        # Inicializa Docker Buildx, una extensión que permite la construcción de imágenes avanzadas,
        # incluidas aquellas multiplataforma o con caché optimizado.

      # 5. Construcción de la imagen Docker
      - name: Build Docker image
        working-directory: scripts/backend
        run: docker build -t bioprint-backend .
        # Construye la imagen Docker del backend utilizando el Dockerfile definido en la ruta indicada.
        # La imagen resultante se etiqueta como "bioprint-backend:latest".
        # Este paso no ejecuta el contenedor, únicamente realiza la construcción de la imagen,
        # lo que asegura la validación del Dockerfile y del entorno de empaquetado.
